<!DOCTYPE html>
<html>
<head>
  <title>NFL Props Analyzer - Real-Time</title>
  <style>
    body { font-family: Arial; background: linear-gradient(135deg, #667eea, #764ba2); padding: 20px; margin: 0; }
    .container { max-width: 1200px; margin: 0 auto; }
    h1 { color: white; text-align: center; margin-bottom: 10px; }
    .subtitle { color: white; text-align: center; opacity: 0.9; margin-bottom: 20px; font-size: 14px; }
    .status { background: white; padding: 15px; border-radius: 10px; margin-bottom: 20px; text-align: center; }
    .status.loading { background: #fff9e6; color: #f59e0b; }
    .status.live { background: #e6f7ff; color: #10b981; }
    .card { background: white; padding: 20px; border-radius: 10px; margin: 20px 0; box-shadow: 0 4px 15px rgba(0,0,0,0.2); }
    .card h2 { margin: 0 0 15px 0; color: #333; }
    select { width: 100%; padding: 12px; font-size: 16px; border: 2px solid #667eea; border-radius: 8px; }
    button { padding: 10px 20px; margin: 5px; border: none; background: #667eea; color: white; border-radius: 20px; cursor: pointer; font-weight: bold; }
    button:hover { background: #5568d3; }
    button.active { background: #764ba2; }
    .prop { background: #f8f9fa; padding: 18px; margin: 12px 0; border-radius: 10px; border-left: 5px solid #667eea; }
    .prop strong { font-size: 18px; color: #333; }
    .prop-detail { margin: 8px 0; color: #555; }
    .stats-row { display: flex; gap: 20px; margin: 10px 0; flex-wrap: wrap; }
    .stat-item { background: white; padding: 10px; border-radius: 8px; }
    .refresh-btn { background: #10b981; margin-bottom: 15px; width: 100%; }
    .refresh-btn:hover { background: #059669; }
    .live-dot { display: inline-block; width: 10px; height: 10px; background: #10b981; border-radius: 50%; margin-right: 8px; animation: pulse 2s infinite; }
    @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
  </style>
</head>
<body>
  <div class="container">
    <h1>NFL Props Analyzer</h1>
    <div class="subtitle">Real-time live prop odds from sportsbooks</div>
    
    <div class="status loading" id="status">
      <span class="live-dot"></span>
      <span id="statusText">Connecting to live odds data...</span>
    </div>

    <div class="card" id="gameCard" style="display:none;">
      <h2>Select Game</h2>
      <select id="game" onchange="loadGame()">
        <option value="">-- Pick a Game --</option>
      </select>
      <button class="refresh-btn" onclick="refreshGames()">Refresh Games</button>
    </div>
    
    <div class="card" id="filters" style="display:none;">
      <h2>Filter Props</h2>
      <button class="active" onclick="filterProps('all', this)">All Props</button>
      <button onclick="filterProps('pass', this)">Passing</button>
      <button onclick="filterProps('rush', this)">Rushing</button>
      <button onclick="filterProps('rec', this)">Receiving</button>
      <button onclick="filterProps('td', this)">Touchdowns</button>
      <button class="refresh-btn" onclick="refreshProps()">Update Live Odds</button>
    </div>
    
    <div id="props"></div>

    <div class="card" id="recommendations" style="display:none;">
      <h2>Live Props</h2>
      <div id="recsBody"></div>
    </div>

    <div id="error"></div>
  </div>
  
  <script>
    const API_BASE = 'https://nfl-props-api-seven.vercel.app/';
    
    let games = [];
    let currentGame = null;
    let filterType = 'all';

    window.onload = function() {
      console.log('App loaded, API:', API_BASE);
      loadLiveGames();
      setInterval(refreshProps, 30000);
    };

    async function loadLiveGames() {
      try {
        updateStatus('Fetching live NFL games...', 'loading');
        
        const url = API_BASE + '/api/games?action=games';
        console.log('Fetching from:', url);
        
        const response = await fetch(url);
        const data = await response.json();
        console.log('Games response:', data);
        
        if (data.events && data.events.length > 0) {
          populateGames(data.events);
          updateStatus('Connected to live odds', 'live');
        } else {
          loadSampleGames();
          updateStatus('Using sample data (no live games)', 'loading');
        }
      } catch (error) {
        console.error('Error loading games:', error);
        loadSampleGames();
        updateStatus('Using sample data (error connecting)', 'loading');
      }
    }

    async function refreshProps() {
      if (!currentGame) return;
      try {
        const url = API_BASE + '/api/props?action=props';
        const response = await fetch(url);
        const data = await response.json();
        if (data.success) {
          renderProps();
        }
      } catch (error) {
        console.log('Could not refresh:', error);
      }
    }

    function refreshGames() {
      loadLiveGames();
    }

    function populateGames(gameList) {
      games = gameList;
      const select = document.getElementById('game');
      select.innerHTML = '<option value="">-- Pick a Game --</option>';

      gameList.forEach((game, idx) => {
        const option = document.createElement('option');
        option.value = idx;
        const away = (game.away_team || game.away_name || 'Away');
        const home = (game.home_team || game.home_name || 'Home');
        option.textContent = `${away} @ ${home}`;
        select.appendChild(option);
      });

      document.getElementById('gameCard').style.display = 'block';
    }

    function loadSampleGames() {
      games = [
        { away_team: 'Kansas City Chiefs', home_team: 'Buffalo Bills' },
        { away_team: 'San Francisco 49ers', home_team: 'Dallas Cowboys' },
        { away_team: 'Denver Broncos', home_team: 'LA Chargers' }
      ];

      const select = document.getElementById('game');
      select.innerHTML = '<option value="">-- Pick a Game --</option>';
      games.forEach((game, idx) => {
        const option = document.createElement('option');
        option.value = idx;
        option.textContent = `${game.away_team} @ ${game.home_team}`;
        select.appendChild(option);
      });

      document.getElementById('gameCard').style.display = 'block';
    }

    function loadGame() {
      const idx = document.getElementById('game').value;
      if (idx === '') {
        currentGame = null;
        document.getElementById('filters').style.display = 'none';
        document.getElementById('props').innerHTML = '';
        return;
      }
      currentGame = games[idx];
      document.getElementById('filters').style.display = 'block';
      filterType = 'all';
      renderProps();
    }

    function filterProps(type, btn) {
      filterType = type;
      document.querySelectorAll('#filters button').forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      renderProps();
    }

    function renderProps() {
      if (!currentGame) return;

      const mockProps = [
        {name: 'QB Passing Yards', type: 'pass', stat: 'Passing Yards', line: 245, odds: -110, bookmaker: 'FanDuel'},
        {name: 'WR Receiving Yards', type: 'rec', stat: 'Receiving Yards', line: 75, odds: -110, bookmaker: 'DraftKings'},
        {name: 'RB Rushing Yards', type: 'rush', stat: 'Rushing Yards', line: 65, odds: -110, bookmaker: 'FanDuel'},
        {name: 'Anytime TD', type: 'td', stat: 'Anytime TD', line: 0.5, odds: -110, bookmaker: 'DraftKings'},
      ];
      
      let filtered = mockProps;
      if (filterType !== 'all') {
        filtered = mockProps.filter(p => p.type === filterType);
      }

      let html = '';
      filtered.forEach((p, idx) => {
        html += `<div class="prop">
          <strong>#${idx + 1} - ${p.name}</strong>
          <div class="prop-detail"><strong>${p.stat}</strong></div>
          <div class="stats-row">
            <div class="stat-item">
              <div style="font-size:12px;color:#666;">BOOKMAKER</div>
              <div style="font-size:14px;font-weight:bold;">${p.bookmaker}</div>
            </div>
            <div class="stat-item">
              <div style="font-size:12px;color:#666;">LINE</div>
              <div style="font-size:18px;font-weight:bold;">${p.line}</div>
            </div>
            <div class="stat-item">
              <div style="font-size:12px;color:#666;">ODDS</div>
              <div style="font-size:18px;font-weight:bold;">${p.odds}</div>
            </div>
          </div>
        </div>`;
      });

      document.getElementById('props').innerHTML = html || '<p>No props</p>';
      
      let recHtml = '<div style="padding:15px;background:#f0f7ff;border-radius:10px;border-left:5px solid #10b981;">';
      recHtml += '<strong>Live Props</strong>';
      recHtml += '<p style="margin-top:10px;color:#555;">Odds update every 30 seconds.</p>';
      recHtml += '</div>';
      
      document.getElementById('recsBody').innerHTML = recHtml;
      document.getElementById('recommendations').style.display = 'block';
    }

    function updateStatus(text, mode) {
      document.getElementById('statusText').textContent = text;
      document.getElementById('status').className = `status ${mode}`;
    }
  </script>
</body>
</html>
